https://hono.dev/docs/guides/best-practices

- è·¯ç”±è§„èŒƒ
- æœåŠ¡æ‹†åˆ†è§„èŒƒ
- æ¥å£ä¸æœåŠ¡ä¸­çš„é”™è¯¯å¤„ç†
- å…¥å£æ–‡ä»¶å†…å®¹è§„èŒƒ
- æ–‡ä»¶å­˜æ”¾è§„èŒƒ
- è¿”å›å“åº”è§„èŒƒ
- eslinté…ç½®

## è·¯ç”±è§„èŒƒ
### å°½å¯èƒ½ä¸è¦åˆ¶ä½œâ€œæ§åˆ¶å™¨â€
å¦‚æœå¯èƒ½ï¼Œæ‚¨ä¸åº”è¯¥åˆ›å»ºâ€œç±»ä¼¼ Ruby on Rails çš„æ§åˆ¶å™¨â€ã€‚
```ts
// ğŸ™
// A RoR-like Controller
const booksList = (c: Context) => {
  return c.json('list books')
}

app.get('/books', booksList)
```

è¯¥é—®é¢˜ä¸ç±»å‹æœ‰å…³ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä¸ç¼–å†™å¤æ‚çš„æ³›å‹ï¼Œå°±æ— æ³•åœ¨ Controller ä¸­æ¨æ–­å‡ºè·¯å¾„å‚æ•°ã€‚
```ts
// ğŸ™
// A RoR-like Controller
const bookPermalink = (c: Context) => {
  const id = c.req.param('id') // Can't infer the path param
  return c.json(`get ${id}`)
}
```

å› æ­¤ï¼Œæ‚¨ä¸éœ€è¦åˆ›å»ºç±»ä¼¼ RoR çš„æ§åˆ¶å™¨ï¼Œè€Œåº”è¯¥ç›´æ¥åœ¨è·¯å¾„å®šä¹‰ä¹‹åç¼–å†™å¤„ç†ç¨‹åºã€‚
```ts
// ğŸ˜ƒ
app.get('/books/:id', (c) => {
  const id = c.req.param('id') // Can infer the path param
  return c.json(`get ${id}`)
})
```
æ˜ç™½äº†ï¼Œä»¥å‰è‡ªå·±æ˜¯åˆ›å»ºäº†ç±»ä¼¼ RoR çš„æ§åˆ¶å™¨çš„ï¼Œç°åœ¨ç›´æ¥åœ¨è·¯å¾„å®šä¹‰ä¹‹åç¼–å†™å¤„ç†ç¨‹åºå§

### æ„å»ºæ›´å¤§çš„åº”ç”¨ç¨‹åº
ä½¿ç”¨ `app.route()` æ„å»ºæ›´å¤§çš„åº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€åˆ›å»ºâ€œç±»ä¼¼ Ruby on Rails çš„æ§åˆ¶å™¨â€ã€‚

å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæœ‰ `/authors` å’Œ `/books` ç«¯ç‚¹å¹¶ä¸”æ‚¨å¸Œæœ›ä»ä¸­åˆ†ç¦»æ–‡ä»¶ `index.ts`ï¼Œ åˆ›é€  `authors.ts` å’Œ `books.ts`.
```ts
// authors.ts
import { Hono } from 'hono'

const app = new Hono()

app.get('/', (c) => c.json('list authors'))
app.post('/', (c) => c.json('create an author', 201))
app.get('/:id', (c) => c.json(`get ${c.req.param('id')}`))

export default app
```

```ts
// books.ts
import { Hono } from 'hono'

const app = new Hono()

app.get('/', (c) => c.json('list books'))
app.post('/', (c) => c.json('create a book', 201))
app.get('/:id', (c) => c.json(`get ${c.req.param('id')}`))

export default app
```

ç„¶åï¼Œå¯¼å…¥å®ƒä»¬å¹¶å®‰è£…åœ¨è·¯å¾„ä¸Š `/authors` å’Œ `/books` å’Œ `app.route()`.
```ts
// index.ts
import { Hono } from 'hono'
import authors from './authors'
import books from './books'

const app = new Hono()

app.route('/authors', authors)
app.route('/books', books)

export default app
```


## æœåŠ¡æ‹†åˆ†è§„èŒƒ
æœåŠ¡å‡½æ•°ä¿å­˜åœ¨ /src/services æ–‡ä»¶å¤¹ä¸‹ï¼Œç”±è·¯ç”±å¤„ç†å‡½æ•°å¯¼å…¥ä½¿ç”¨
- å°†çº¯æŸ¥è¯¢æ“ä½œæ•°æ®åº“çš„å‡½æ•°æ”¾åœ¨ `src\services\data.ts`
- å°†æ¯”è¾ƒåŸºç¡€çš„æ”¾åœ¨ `src\services\base.ts`ï¼ˆçœ‹æ„Ÿè§‰å§ï¼‰
- å¯ä»¥å…ˆå†™åœ¨å½“å‰æ–‡ä»¶

ã€å¾…å®Œå–„ã€‘


## å“åº”æ•°æ®å¤„ç†
```ts
// src/utils/dataHandlers.ts
// å“åº”æ•°æ®å¤„ç†
export const handleResData = (
  code: number, message: string, data?: any, token?: string
): ResData => {
  return {
    code,
    message,
    data,
    token
  }
}
```
åœ¨è¿”å›æ—¶è°ƒç”¨ï¼Œèµ·åˆ°ç®€åŒ–ä½œç”¨

## æ¥å£ä¸æœåŠ¡ä¸­çš„é”™è¯¯å¤„ç†
è‡ªå®šä¹‰é”™è¯¯ç±»ï¼ŒstatusCodeæ˜¯å¯é€‰çš„ï¼Œåœ¨ç¡®è®¤é”™è¯¯ç±»å‹æ—¶å†æ·»åŠ 
```ts
// src/classes/errors.ts
// è‡ªå®šä¹‰é”™è¯¯ç±»
class AppError extends Error {
  constructor(public message: string, public statusCode?: StatusCode) {
    super(message);
    this.name = 'AppError';
  }
}
// å¦ä¸€ç§å†™æ³•
export class AppError extends Error {
  statusCode: StatusCode | undefined;
  constructor(message: string, statusCode?: StatusCode) {
    super(message) // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
    this.name = 'AppError'
    this.message = message
    this.statusCode = statusCode
  }
}
```

é”™è¯¯å¤„ç†è¾…åŠ©å‡½æ•°
```ts
// src/utils/errorHandlers.ts
// é”™è¯¯å¤„ç†è¾…åŠ©å‡½æ•°
export const handleAppError = (error: any, message: string, statusCode?: StatusCode) => {
  if (error instanceof AppError) {
    error.message = `${message} | ${error.message}`;
    if (statusCode !== undefined) error.statusCode = statusCode
    throw error;
  } else {
    throw new AppError(`${message}`, statusCode);
  }
};
```

åœ¨æœåŠ¡å‡½æ•°æŠ›å‡ºé”™è¯¯ï¼Œè¢«ä¸Šçº§æ•è·åï¼Œæ‹¼æ¥é”™è¯¯ä¿¡æ¯é‡æ–°æŠ›å‡ºã€‚æœ€ç»ˆä¼šè¢«å…¨å±€é”™è¯¯æ•è·å¤„ç†å¹¶å“åº”
```ts
const otherServiceFunction = async ()=>{
Â  throw new Error()
}

// æœåŠ¡å‡½æ•°
export const oneServiceFunction = async () => {
  await otherServiceFunction()
    .catch((error) => handleAppError(error, 'oneError'));
};

const app = new Hono()
app.get('/', async (c) => {
  await oneServiceFunction()
  return c.text('Hello Hono!');
});

app.onError((error, c)=>{
  if (error instanceof AppError) {
    c.status(error.statusCode ?? 500);
    return c.json(handleResData(1, error.message))
  }
  c.status(500);
  return c.json(handleResData(1, 'Internal Server Error'))
})
```

## å…¨å±€é”™è¯¯å¤„ç†
```ts
// src/utils/errorHandlers.ts
// å…¨å±€é”™è¯¯å¤„ç†
export const handleGlobalError: Parameters<Hono['onError']>[0] = (error, c) => {
  // handle AppError
  if (error instanceof AppError) {
    c.status(error.statusCode ?? 500)
    return c.json(handleResData(1, error.message))
  }
  // handle HTTPException
  // for example: Malformed JSON in request body
  if (error instanceof HTTPException) {
    c.status(error.status)
    return c.json(handleResData(1, error.message))
  }
  // unknown error
  c.status(500)
  return c.json(handleResData(1, `unknown error: ${error.message}`))
}

// src\index.ts
app.onError(handleGlobalError)
```

å¦‚æœè¯·æ±‚ä¸­jsonæ ¼å¼é”™è¯¯ï¼Œä¼šè¢« handle HTTPException æ•è·å¹¶è¿”å›

å°†é”™è¯¯å¤„ç†å°è£…ï¼Œä»¥å‡å°å…¥å£æ–‡ä»¶å¤æ‚åº¦